<!DOCTYPE html>
<html lang="ko">

{% load static %}
<!-- (ë©”ëª¨) ëª¨ë“  ì •ì  íŒŒì¼ì˜ ìš”ì²­ ê²½ë¡œë¥¼ eval_service/static/... ìœ¼ë¡œ ì„¤ì •-->

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í‰ê°€ ë‚´ì—­</title>
    <link rel="stylesheet" href="{% static 'css/base.css' %}" type="text/css">
    <link rel="shortcut icon" href="{% static 'img/favicon.ico' %}"/>
    <link rel="stylesheet" href="{% static 'css/show_eval_result.css' %}"/>
    <script src="https://code.jscharting.com/latest/jscharting.js"></script>
</head>

<body>
    <!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” ë³„ë„ë¡œ import-->
    {% include "base.html" %}

    <div class="container">
        <h1>í‰ê°€ ê²°ê³¼ ìš”ì•½</h1>
        <div class="summary">
            <div class="info-box">
                <h3>í‰ê°€ ì¼ì‹œ ë° í‰ê°€ì ì •ë³´</h3>
                <table>
                    <tr>
                        <td>í‰ê°€ì¼ì</td>
                        <td>{{evaluation_date}}</td>
                    </tr>
                    <tr>
                        <td>ì œì¶œì¼ì</td>
                        <td>{{created_date}}</td>
                    </tr>
                    <tr>
                        <td>í‰ê°€ì ì´ë©”ì¼</td>
                        <td>{{evaluator_email}}</td>
                    </tr>
                </table>
            </div>
            <div class="chart-box">
                <h2>ë²”ì£¼ ë³„ ë‹¬ì„±ë¥ </h2>
                <br>
                <svg id="radarChart" class="radar-chart"></svg>
            </div>
        </div>
        <!--
        <div class="score-summary">
            <div class="score-row">
                <span class="icon">âš™ï¸</span>
                <span>ì¼ë°˜ ì‚¬í•­</span>
                <div class="progress-bar">
                    <div class="progress" style="width: 0%;"></div>
                </div>
                <span>0%</span>
            </div>
            <div class="score-row">
                <span class="icon">ğŸ”„</span>
                <span>ê°œë°œ ìƒëª…ì£¼ê¸°</span>
                <div class="progress-bar">
                    <div class="progress" style="width: 0%;"></div>
                </div>
                <span>0%</span>
            </div>
            <div class="score-row">
                <span class="icon">ğŸŒ</span>
                <span>ê³µê¸‰ì—…ì²´ ê´€ë¦¬</span>
                <div class="progress-bar">
                    <div class="progress" style="width: 0%;"></div>
                </div>
                <span>0%</span>
            </div>
            <div class="score-row">
                <span class="icon">âš ï¸</span>
                <span>ìœ„í—˜ ê´€ë¦¬</span>
                <div class="progress-bar">
                    <div class="progress" style="width: 0%;"></div>
                </div>
                <span>0%</span>
            </div>
        </div>
    </div>
    -->
    <div class="container">
        <h1>í‰ê°€ ê²°ê³¼ ìƒì„¸ (í•­ëª©ë³„)</h1>
        <br>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <!-- í‘œ ë¨¸ë¦¿ë§ ìƒì„± -->
                        {% for column in columns %}
                        <th>{{ column }}</th>
                        {% endfor %}
                    </tr>
                </thead>
            
                <tbody>
                <!-- í‘œì˜ ê° í–‰ ìƒì„± -->
                {% for row in result_list %}
                <tr>
                    <td>{{row.ë²ˆí˜¸}} <input type="hidden" value="{{row.ë²ˆí˜¸}}" name="result{{row.ë²ˆí˜¸}}[number]"></td>
                    <td>{{row.ë²”ì£¼}} <input type="hidden" value="{{row.ë²”ì£¼}}" name="result{{row.ë²ˆí˜¸}}[category]"></td>
                    <td>{{row.í•­ëª©}} </td>
                    <td>{{ row.í‰ê°€_ê¸°ì¤€ }} </td>
                    <td class="icon">
                        <button class="help-btn">
                            <img src="{% static 'img/help_question.png' %}" alt="ì§ˆë¬¸_ì˜ˆì‹œ">
                            <span class="tooltip">{{row.ì§ˆë¬¸_ì˜ˆì‹œ | linebreaksbr}}</span>
                        </button>
                    </td>
                    <td class="icon">
                        <button class="help-btn">
                            <img src="{% static 'img/help_question.png' %}" alt="ì¦ê±°ë¬¼ ì˜ˆì‹œ">
                            <span class="tooltip">{{row.ì¦ê±°ìë£Œ_ì˜ˆì‹œ  | linebreaksbr }}</span>
                        </button>
                    </td>
                    <td class="icon">
                        <button class="help-btn">
                            <img src="{% static 'img/help_question.png' %}" alt="ë¶ˆí•©ê²© ì‚¬ë¡€">
                            <span class="tooltip">{{ row.ì¸ì¦ê¸°ì¤€_ë¶ˆí•©ê²©_ì‚¬ë¡€  | linebreaksbr }}</span>
                        </button>
                    </td>
                    <td>
                        {% if row.passfail == "P" %}
                        <label>
                            <!--<input type="radio" name="result{{row.ë²ˆí˜¸}}[passfail]" value="P" checked> í•©ê²©-->
                            <img src="{% static 'img/pass.png' %}" alt="í†µê³¼" class="pass_failure_icon">
                        </label>
                        {% else %}
                        <label>
                            <!--<input type="radio" name="result{{row.ë²ˆí˜¸}}[passfail]" value="F"> ë¶ˆí•©ê²© -->
                            <img src="{% static 'img/nonpass.png' %}" alt="ë¶ˆí†µ" class="pass_failure_icon">
                        </label>
                        {% endif %}
                    </td>
                    <td>
                        <!--<input type="text" value="" class="eval_result_data" id="pass_failure_rationale" placeholder="í†µê³¼ ë° ë¶ˆí•©ê²© ì‚¬ìœ  ì…ë ¥">-->
                        <textarea class="pass_failure_rationale" name="result{{row.ë²ˆí˜¸}}[rationale]"  placeholder="í†µê³¼ ë° ë¶ˆí•©ê²© ì‚¬ìœ  ì…ë ¥" readonly>{{ row.rationale }}</textarea>
                    </td>
                </tr>
                {% endfor %}
           
                    <!-- ì¶”ê°€ í–‰ -->
                </tbody>
            </table>
            <!-- ì—¬ê¸°ì— í‰ê°€ í•­ëª© í‘œ HTML ì¶”ê°€ -->
    </div>
    </div>

    <script>

    const chartData = JSON.parse('{{ completion_ratio|safe }}');

    console.log("Chart Data:", chartData);

    // ë”•ì…”ë„ˆë¦¬ì˜ í‚¤ë¥¼ ë¼ë²¨ë¡œ, ê°’ì„ ë°ì´í„° ê°’ìœ¼ë¡œ ë¶„ë¦¬
    const labels = Object.keys(chartData); // ["í•­ëª©1", "í•­ëª©2", "í•­ëª©3"]
    const data = Object.values(chartData); // [70, 50, 90]
//const data = [78.2, 81.2, 54.5,33.2,12.3]; // ë°ì´í„° ê°’ (0~100 ë²”ìœ„)
//const labels = ["ì •ë³´ë³´í˜¸ ê´€ë¦¬ì²´ê³„", "ì‚¬ì´ë²„ë³´ì•ˆ ì—”ì§€ë‹ˆì–´ë§", "ì‚¬ì´ë²„ë³´ì•ˆ ìœ„í—˜ê´€ë¦¬","ê³µê¸‰ë§ ê´€ë¦¬","ì‚¬ì´ë²„ë³´ì•ˆ êµìœ¡ë°ì¸ì§€"]; // í•­ëª© ë ˆì´ë¸”
const levels = 5; // ë ˆì´ë” ì°¨íŠ¸ ë ˆë²¨ ìˆ˜
const maxValue = 100; // ë°ì´í„° ìµœëŒ€ê°’
const chartSize = 200; // ì°¨íŠ¸ ë°˜ì§€ë¦„
const padding = 50; // íŒ¨ë”© ì¶”ê°€ (ì˜ë¦¼ ë°©ì§€)
const centerX = chartSize + padding; // ì°¨íŠ¸ ì¤‘ì‹¬ X ì¢Œí‘œ
const centerY = chartSize + padding; // ì°¨íŠ¸ ì¤‘ì‹¬ Y ì¢Œí‘œ
const startAngle = -Math.PI / 2; // ì²« ë²ˆì§¸ ì ì„ ìœ„ìª½ì— ë°°ì¹˜ (-90ë„)

// SVG ìƒì„±
const svg = document.getElementById("radarChart");
svg.setAttribute("viewBox", `0 0 ${chartSize * 2 + padding * 2} ${chartSize * 2 + padding * 2}`);
svg.setAttribute("width", `${chartSize * 2 + padding * 2}`);
svg.setAttribute("height", `${chartSize * 2 + padding * 2}`);

// ì›í˜• ë ˆë²¨ ê·¸ë¦¬ê¸° ë° ê²½ê³„ê°’ ì¶”ê°€
for (let level = 1; level <= levels; level++) {
    const radius = (chartSize / levels) * level;
    const polygon = createPolygon(radius, labels.length);
    polygon.setAttribute("stroke", "#ccc");
    polygon.setAttribute("fill", "none");
    svg.appendChild(polygon);

    // ê²½ê³„ê°’ì„ ë³€ ìœ„ì— ì •í™•íˆ ë°°ì¹˜
    for (let i = 0; i < labels.length; i++) {
        const angle1 = startAngle + (2 * Math.PI / labels.length) * i;
        const angle2 = startAngle + (2 * Math.PI / labels.length) * (i + 1);

        // ë³€ì˜ ì‹œì‘ì ê³¼ ëì  ê³„ì‚°
        const x1 = centerX + Math.cos(angle1) * radius;
        const y1 = centerY + Math.sin(angle1) * radius;
        const x2 = centerX + Math.cos(angle2) * radius;
        const y2 = centerY + Math.sin(angle2) * radius;

        // ë³€ì˜ ì¤‘ê°„ ì§€ì  ê³„ì‚°
        const midX = (x1 + x2) / 2;
        const midY = (y1 + y2) / 2;

        const levelValue = (maxValue / levels) * level;
        const levelText = document.createElementNS("http://www.w3.org/2000/svg", "text");
        levelText.setAttribute("x", midX);
        levelText.setAttribute("y", midY);
        levelText.setAttribute("class", "axis-label");
        levelText.textContent = levelValue;
        levelText.style.textAnchor = "middle";

        // ì •ë ¬ê³¼ ê°ë„ì— ë”°ë¼ ìˆ˜ì§ ì •ë ¬ ì„¤ì •
        levelText.style.dominantBaseline = "central"; // ë³€ ìœ„ ì¤‘ì•™ì— ìœ„ì¹˜
        levelText.style.fontSize = "12px";
        levelText.style.fontWeight = "bold"; // ë³¼ë“œ ì²˜ë¦¬
        svg.appendChild(levelText);
    }
}

// ë°ì´í„° ë‹¤ê°í˜• ê·¸ë¦¬ê¸°
const dataPolygon = createPolygonFromData(data, maxValue, chartSize);
dataPolygon.setAttribute("stroke", "#4caf50");
dataPolygon.setAttribute("fill", "rgba(76, 175, 80, 0.5)");
svg.appendChild(dataPolygon);

// ë°ì´í„° ê°’ í‘œì‹œ ìœ„ì¹˜ ì¡°ì •
data.forEach((value, index) => {
    const angle = startAngle + (2 * Math.PI / data.length) * index;
    const radius = (value / maxValue) * chartSize;
    const x = centerX + Math.cos(angle) * radius;
    const y = centerY + Math.sin(angle) * radius;

    const valueText = document.createElementNS("http://www.w3.org/2000/svg", "text");
    valueText.setAttribute("x", x);
    valueText.setAttribute("y", y - 10); // ë°ì´í„° ê°’ì„ ì•½ê°„ ìœ„ìª½ìœ¼ë¡œ ì´ë™
    valueText.setAttribute("class", "data-label");
    valueText.textContent = value.toFixed(1); // ì†Œìˆ˜ì  ì²«ì§¸ ìë¦¬ê¹Œì§€ë§Œ í‘œì‹œ
    valueText.style.textAnchor = "middle";
    valueText.style.fontSize = "12px";
    valueText.style.fill = "#333";
    svg.appendChild(valueText);
});

// ë ˆì´ë¸” ìœ„ì¹˜ ì¡°ì • ë° ì˜ë¦¼ ë°©ì§€
labels.forEach((label, index) => {
    const angle = startAngle + (2 * Math.PI / labels.length) * index;
    const x = centerX + Math.cos(angle) * (chartSize + 25); // ì•½ê°„ ë” ë°”ê¹¥ìª½ìœ¼ë¡œ ìœ„ì¹˜ ì¡°ì •
    const y = centerY + Math.sin(angle) * (chartSize + 25); // ìœ„ì¹˜ ì¡°ì •
    const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
    text.setAttribute("x", x);
    text.setAttribute("y", y);
    text.setAttribute("class", "axis-label");
    text.textContent = label;

    // í…ìŠ¤íŠ¸ ì •ë ¬ ë° ìœ„ì¹˜ ë³´ì •
    text.style.textAnchor = "middle";
    text.style.dominantBaseline = "central"; // ìˆ˜ì§ ì •ë ¬
    svg.appendChild(text);
});

// ë‹¤ê°í˜• ìƒì„± í•¨ìˆ˜
function createPolygon(radius, pointsCount) {
    const points = [];
    for (let i = 0; i < pointsCount; i++) {
        const angle = startAngle + (2 * Math.PI / pointsCount) * i;
        const x = centerX + Math.cos(angle) * radius;
        const y = centerY + Math.sin(angle) * radius;
        points.push(`${x},${y}`);
    }
    const polygon = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
    polygon.setAttribute("points", points.join(" "));
    return polygon;
}

// ë°ì´í„° ê¸°ë°˜ ë‹¤ê°í˜• ìƒì„± í•¨ìˆ˜
function createPolygonFromData(data, maxValue, size) {
    const points = [];
    data.forEach((value, index) => {
        const angle = startAngle + (2 * Math.PI / data.length) * index;
        const radius = (value / maxValue) * size;
        const x = centerX + Math.cos(angle) * radius;
        const y = centerY + Math.sin(angle) * radius;
        points.push(`${x},${y}`);
    });
    const polygon = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
    polygon.setAttribute("points", points.join(" "));
    return polygon;
}



        /*
// ì´ˆê¸° ì°¨íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
const chart = new JSC.Chart('spiderChart', {
    type: 'radar',
    legend_visible: false,
    xAxis: {
        scale: { interval: 1 }
    },
    yAxis: {
        scale: { 
            range: [0, 100], // Yì¶•ì˜ ë²”ìœ„ë¥¼ 0ì—ì„œ 100ìœ¼ë¡œ ê³ ì •
            interval: 20 // Yì¶• ëˆˆê¸ˆ ê°„ê²©ì„ 20ìœ¼ë¡œ ì„¤ì •
        }
    },
    chartArea: {
        margin: 0,
        fill: 'transparent', // ë¶ˆí•„ìš”í•œ ë°°ê²½ ì œê±°
    },
    defaultSeries: {
        shape: 'polygon', // ì°¨íŠ¸ë¥¼ ë‹¤ê°í˜•ìœ¼ë¡œ ì„¤ì •
        defaultPoint_label: {
            visible: true,
            placement: 'outside', // ë°ì´í„° ë ˆì´ë¸”ì„ ì°¨íŠ¸ ë°”ê¹¥ìª½ì— ë°°ì¹˜
        }
    },
    series: [
        {
            name: 'í‰ê°€ ì ìˆ˜',
            points: [
                { x: 'ì¼ë°˜ ì‚¬í•­', y: 11 },
                { x: 'ê°œë°œ ìƒëª…ì£¼ê¸°', y: 23 },
                { x: 'ê³µê¸‰ì—…ì²´ ê´€ë¦¬', y: 80 },
                { x: 'ìœ„í—˜ ê´€ë¦¬', y: 34 }
            ]
        }
    ]
});


// ë°•ìŠ¤ í¬ê¸°ë¥¼ ê°ì§€í•˜ì—¬ ì°¨íŠ¸ í¬ê¸° ì—…ë°ì´íŠ¸ í•¨ìˆ˜
function resizeChart() {
    const chartBox = document.querySelector('.chart-box'); // ì°¨íŠ¸ê°€ í¬í•¨ëœ ë°•ìŠ¤ ì„ íƒ
    const chartElement = document.getElementById('spiderChart'); // ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ ì„ íƒ

    // ë¶€ëª¨ ë°•ìŠ¤ í¬ê¸°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ í¬ê¸° ì¡°ì •
    chartElement.style.width = `${chartBox.clientWidth+60}px`;
    chartElement.style.height = `${chartBox.clientHeight+60}px`;

    // ì°¨íŠ¸ë„ í¬ê¸° ì—…ë°ì´íŠ¸
    chart.options({ width: chartBox.clientWidth+60, height: chartBox.clientHeight+60 });
}

// ì´ˆê¸° ì‹¤í–‰
resizeChart();

// ì°½ í¬ê¸° ë³€ê²½ ì‹œ ì°¨íŠ¸ í¬ê¸° ì—…ë°ì´íŠ¸
window.addEventListener('resize', resizeChart);

*/
    </script>
    <!-- <h1>í‰ê°€ ê²°ê³¼ ë³´ì—¬ì£¼ê¸°</h1> -->
</body>
</html>




